import{f as y,a as h}from"../chunks/Bu6yjzp-.js";import{i as qe}from"../chunks/Ba54wowS.js";import{o as Ie}from"../chunks/DeF66miZ.js";import{h as he,B as Je,a5 as ye,a6 as We,n as Ge,K as _,F as i,C as a,x as t,D as Xe,J as o,a7 as p,G as l,a8 as O,a9 as J,t as j,y as Ye}from"../chunks/BcDtKVn4.js";import{e as f,s as k}from"../chunks/BqWBJ0nJ.js";import{i as M}from"../chunks/BkkIdlLT.js";import{c as Ze,b as W,a as H,r as G,s as we}from"../chunks/B3X5vNgQ.js";function ta(b,B,w,d){var v=b.__style;if(he||v!==B){var u=Ze(B);(!he||u!==b.getAttribute("style"))&&(u==null?b.removeAttribute("style"):b.style.cssText=u),b.__style=B}return d}const ea=globalThis.__sveltekit_t4h48i.env,et=(ea.PUBLIC_BACKEND_URL||"http://localhost:8000").replace(/\/$/,"");async function aa(b,B,w=128,d){const v=new FormData;v.append("file",b),v.append("target_size_mb",String(B)),v.append("audio_bitrate_kbps",String(w));const u={},S=await fetch(`${et}/api/upload`,{method:"POST",body:v,headers:u});if(!S.ok)throw new Error(await S.text());return S.json()}async function oa(b,B){const w={"Content-Type":"application/json"},d=await fetch(`${et}/api/compress`,{method:"POST",body:JSON.stringify(b),headers:w});if(!d.ok)throw new Error(await d.text());return d.json()}function sa(b,B){const w=new URL(`${et}/api/stream/${b}`);return new EventSource(w.toString())}function ke(b){return`${et}/api/jobs/${b}/download`}var ia=y('<span class="opacity-70"> </span>'),la=y('<p class="mt-2 text-sm text-gray-400"> <!></p>'),ra=y('<p class="mt-2 text-xs text-amber-400"> </p>'),na=y('<p class="text-xs opacity-80"> </p>'),pa=y('<p class="text-amber-400 text-sm mt-1"> </p>'),da=y('<div class="card"><p class="text-sm"> </p> <!> <!></div>'),va=y('<div class="card border-red-500"><p class="text-red-400"> </p></div>'),ca=y('<div class="mt-4 text-sm"><p> </p> <a class="btn inline-block mt-2" target="_blank">Download</a></div>'),ua=y('<div class="card"><div class="h-3 bg-gray-800 rounded"><div class="h-3 bg-indigo-600 rounded"></div></div> <details class="mt-3"><summary>FFmpeg log</summary> <pre class="mt-2 text-xs whitespace-pre-wrap"> </pre></details> <!></div>'),_a=y(`<div id="support-popover" class="fixed bottom-16 right-4 w-64 bg-gray-900/95 text-gray-100 border border-gray-700 rounded-lg shadow-xl p-3 z-50" role="dialog" aria-label="Support the project"><div class="flex items-start justify-between gap-2"><p class="text-xs leading-relaxed">Thanks for using <span class="font-semibold">8mb.local</span>! If this saved you time and you'd like to chip in, tips are appreciated (never expected).</p> <button class="text-gray-400 hover:text-gray-200 text-sm" title="Close" aria-label="Close">×</button></div> <div class="mt-2"><a class="underline text-xs hover:text-rose-300" href="https://paypal.me/jasonselsley" target="_blank" rel="noopener noreferrer">paypal.me/jasonselsley</a></div></div>`),ba=y(`<div class="max-w-3xl mx-auto mt-8 space-y-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl font-bold">8mb.local</h1> <a href="/settings" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors text-sm">⚙️ Settings</a></div> <div class="card"><div class="border-2 border-dashed border-gray-700 rounded p-8 text-center"><p class="mb-2">Drag & drop a video here</p> <input type="file" accept="video/*"/> <!></div></div> <div class="card grid grid-cols-2 gap-4"><div class="space-x-2"><button class="btn">4MB</button> <button class="btn">5MB</button> <button class="btn">8MB</button> <button class="btn">10MB (Discord)</button> <button class="btn">50MB</button> <button class="btn">100MB</button></div> <div class="flex items-center gap-2 justify-end"><label class="text-sm">Custom size (MB)</label> <input class="input w-28" type="number" min="1"/></div></div> <div class="card"><details><summary class="cursor-pointer">Advanced Options</summary> <div class="mt-4 grid sm:grid-cols-4 gap-4"><div><label class="block mb-1 text-sm">Video Codec</label> <select class="input w-full"><option>AV1 (Best Quality - new RTX)</option><option>HEVC (H.265)</option><option>H.264 (Compatibility)</option></select></div> <div><label class="block mb-1 text-sm">Audio Codec</label> <select class="input w-full"><option>Opus (Default)</option><option>AAC</option></select></div> <div><label class="block mb-1 text-sm">Speed/Quality</label> <select class="input w-full"><option>Fast (P1)</option><option>Balanced (P5)</option><option>Best Quality (P7)</option><option>Default (P6)</option></select></div> <div><label class="block mb-1 text-sm">Container</label> <select class="input w-full"><option>MP4 (Most compatible)</option><option>MKV (Best with Opus)</option></select></div> <div><label class="block mb-1 text-sm">Audio Bitrate (kbps)</label> <select class="input w-full"><option>64</option><option>96</option><option>128</option><option>160</option><option>192</option><option>256</option></select></div> <div><label class="block mb-1 text-sm flex items-center gap-1">Tune <span class="text-[11px] opacity-70">(what to prioritize)</span></label> <select class="input w-full" title="Tune tells the encoder what to optimize for."><option>Best Quality (HQ)</option><option>Low Latency (faster)</option><option>Ultra‑Low Latency (fastest)</option><option>Lossless (no quality loss)</option></select> <p class="mt-1 text-xs opacity-70">Quality = best visuals. Low/Ultra‑low latency = faster encodes (good for screen/streams). Lossless = huge files.</p></div></div> <div class="mt-4 pt-4 border-t border-gray-700"><h4 class="text-sm font-medium mb-3">Resolution & Trimming</h4> <div class="grid sm:grid-cols-4 gap-4"><div><label class="block mb-1 text-sm">Max Width (px)</label> <input class="input w-full" type="number" placeholder="Original" min="1"/></div> <div><label class="block mb-1 text-sm">Max Height (px)</label> <input class="input w-full" type="number" placeholder="Original" min="1"/></div> <div><label class="block mb-1 text-sm">Start Time</label> <input class="input w-full" type="text" placeholder="0 or 00:00:00"/> <p class="mt-1 text-xs opacity-70">Format: seconds or HH:MM:SS</p></div> <div><label class="block mb-1 text-sm">End Time</label> <input class="input w-full" type="text" placeholder="Full duration"/> <p class="mt-1 text-xs opacity-70">Format: seconds or HH:MM:SS</p></div></div> <p class="mt-2 text-xs opacity-70">Leave resolution blank to keep original. Aspect ratio is maintained.
          Leave times blank to use full duration.</p></div> <!></details></div> <!> <!> <div class="flex gap-2"><button class="btn"> </button> <button class="btn">Compress</button> <button class="btn">Reset</button></div> <!></div> <button class="fixed bottom-4 right-4 bg-gray-800/90 hover:bg-gray-700 text-xs px-3 py-1.5 rounded-full shadow-lg border border-gray-700 backdrop-blur-sm flex items-center gap-1 z-50" aria-controls="support-popover" title="Support the project"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-rose-400"><path d="M11.645 20.91l-.007-.003-.022-.01a15.247 15.247 0 01-.383-.184 25.18 25.18 0 01-4.244-2.62C4.688 16.197 2.25 13.614 2.25 10.5 2.25 8.014 4.237 6 6.75 6c1.56 0 2.927.802 3.75 2.016C11.323 6.802 12.69 6 14.25 6 16.763 6 18.75 8.014 18.75 10.5c0 3.114-2.438 5.697-4.739 7.593a25.175 25.175 0 01-4.244 2.62 15.247 15.247 0 01-.383.184l-.022.01-.007.003-.003.001a.75.75 0 01-.614 0l-.003-.001z"></path></svg> <span>Support</span> <span class="sr-only">the project</span></button> <!>`,1);function ka(b,B){Je(B,!1);const w=p(),d=p();let v=p(null),u=p(25),S=p("av1_nvenc"),z=p("libopus"),E=p("p6"),$=p(128),X=p(null),A=p("mp4"),K=p("hq"),at=p(null),ot=p(null),st=p(""),it=p(""),n=p(null),F=p(null),Y=p(0),L=p([]),Q=p(null),Z=p(null),D=p(null),P=p(!1),V=p(!1);function Me(){o(V,!t(V))}function qt(){o(V,!1)}const Be=e=>{e.key==="Escape"&&qt()};Ie(async()=>{try{const e=await fetch("/api/settings/presets");if(e.ok){const s=await e.json();o(u,s.target_mb),o(S,s.video_codec),o(z,s.audio_codec),o(E,s.preset),o($,s.audio_kbps),o(A,s.container),o(K,s.tune)}}catch{console.warn("Failed to load default presets, using hardcoded defaults")}});function It(e){if(e<1024)return`${e} B`;const s=e/1024;if(s<1024)return`${s.toFixed(1)} KB`;const r=s/1024;return r<1024?`${r.toFixed(2)} MB`:`${(r/1024).toFixed(2)} GB`}function N(e){o(u,e)}function Se(){o(u,9.7)}async function Ce(e){var r;if(e.preventDefault(),!e.dataTransfer)return;const s=(r=e.dataTransfer.files)==null?void 0:r[0];s&&(o(v,s),o(X,It(s.size)),t(P)||await lt())}function $e(e){e.preventDefault()}async function lt(){if(t(v)&&!t(P)){o(P,!0),o(D,null);try{console.log("Uploading to backend...",t(v).name),o(n,await aa(t(v),t(u),t($))),console.log("Upload response:",t(n)),o(Z,t(n).warn_low_quality?`Warning: Very low video bitrate (${Math.round(t(n).estimate_video_kbps)} kbps)`:null)}catch(e){console.error("Upload failed:",e),o(D,`Upload failed: ${e.message||e}`)}finally{o(P,!1)}}}async function Te(){if(t(n)){o(D,null);try{const e={job_id:t(n).job_id,filename:t(n).filename,target_size_mb:t(u),video_codec:t(S),audio_codec:t(z),audio_bitrate_kbps:t($),preset:t(E),container:t(A),tune:t(K),max_width:t(at)||void 0,max_height:t(ot)||void 0,start_time:t(st).trim()||void 0,end_time:t(it).trim()||void 0};console.log("Starting compression...",e);const{task_id:s}=await oa(e);o(F,s);const r=sa(t(F));r.onmessage=g=>{try{const c=JSON.parse(g.data);c.type==="progress"&&o(Y,c.progress),c.type==="log"&&c.message&&o(L,[c.message,...t(L)].slice(0,500)),c.type==="done"&&(o(Q,c.stats),o(Y,100)),c.type==="error"&&o(L,[c.message,...t(L)])}catch{}}}catch(e){console.error("Compress failed:",e),o(D,`Compression failed: ${e.message||e}`)}}}function je(){o(v,null),o(n,null),o(F,null),o(Y,0),o(L,[]),o(Q,null),o(Z,null),o(D,null),o(P,!1)}ye(()=>(t(A),t(z)),()=>{o(w,t(A)==="mp4"&&t(z)==="libopus"?"MP4 does not support Opus; audio will be encoded as AAC automatically.":null)}),ye(()=>(t(n),t(u),t($)),()=>{o(d,t(n)?{duration_s:t(n).duration_s,total_kbps:t(n).duration_s>0?t(u)*8192/t(n).duration_s:0,video_kbps:t(n).duration_s>0?Math.max(t(u)*8192/t(n).duration_s-t($),0):0,final_mb:t(u)}:null)}),We(),qe();var Jt=ba(),rt=Ge(Jt),nt=a(i(rt),2),tt=i(nt),Wt=a(i(tt),2),ze=a(Wt,2);{var Ae=e=>{var s=la(),r=i(s),g=a(r);{var c=T=>{var U=ia(),q=i(U);l(U),_(()=>k(q,`• ${t(X)??""}`)),h(T,U)};M(g,T=>{t(X)&&T(c)})}l(s),_(()=>k(r,`${t(v),j(()=>t(v).name)??""} `)),h(e,s)};M(ze,e=>{t(v)&&e(Ae)})}l(tt),l(nt);var pt=a(nt,2),dt=i(pt),Gt=i(dt),Xt=a(Gt,2),Yt=a(Xt,2),Zt=a(Yt,2),te=a(Zt,2),Fe=a(te,2);l(dt);var ee=a(dt,2),ae=a(i(ee),2);G(ae),l(ee),l(pt);var vt=a(pt,2),oe=i(vt),ct=a(i(oe),2),ut=i(ct),_t=a(i(ut),2);_(()=>{t(S),O(()=>{})});var bt=i(_t);bt.value=bt.__value="av1_nvenc";var mt=a(bt);mt.value=mt.__value="hevc_nvenc";var se=a(mt);se.value=se.__value="h264_nvenc",l(_t),l(ut);var ft=a(ut,2),gt=a(i(ft),2);_(()=>{t(z),O(()=>{})});var xt=i(gt);xt.value=xt.__value="libopus";var ie=a(xt);ie.value=ie.__value="aac",l(gt),l(ft);var ht=a(ft,2),yt=a(i(ht),2);_(()=>{t(E),O(()=>{})});var wt=i(yt);wt.value=wt.__value="p1";var kt=a(wt);kt.value=kt.__value="p5";var Mt=a(kt);Mt.value=Mt.__value="p7";var le=a(Mt);le.value=le.__value="p6",l(yt),l(ht);var Bt=a(ht,2),St=a(i(Bt),2);_(()=>{t(A),O(()=>{})});var Ct=i(St);Ct.value=Ct.__value="mp4";var re=a(Ct);re.value=re.__value="mkv",l(St),l(Bt);var $t=a(Bt,2),Tt=a(i($t),2);_(()=>{t($),O(()=>{})});var jt=i(Tt);jt.value=jt.__value=64;var zt=a(jt);zt.value=zt.__value=96;var At=a(zt);At.value=At.__value=128;var Ft=a(At);Ft.value=Ft.__value=160;var Lt=a(Ft);Lt.value=Lt.__value=192;var ne=a(Lt);ne.value=ne.__value=256,l(Tt),l($t);var pe=a($t,2),Dt=a(i(pe),2);_(()=>{t(K),O(()=>{})});var Pt=i(Dt);Pt.value=Pt.__value="hq";var Ut=a(Pt);Ut.value=Ut.__value="ll";var Ot=a(Ut);Ot.value=Ot.__value="ull";var de=a(Ot);de.value=de.__value="lossless",l(Dt),J(2),l(pe),l(ct);var Ht=a(ct,2),ve=a(i(Ht),2),Et=i(ve),ce=a(i(Et),2);G(ce),l(Et);var Kt=a(Et,2),ue=a(i(Kt),2);G(ue),l(Kt);var Qt=a(Kt,2),_e=a(i(Qt),2);G(_e),J(2),l(Qt);var be=a(Qt,2),me=a(i(be),2);G(me),J(2),l(be),l(ve),J(2),l(Ht);var Le=a(Ht,2);{var De=e=>{var s=ra(),r=i(s,!0);l(s),_(()=>k(r,t(w))),h(e,s)};M(Le,e=>{t(w)&&e(De)})}l(oe),l(vt);var fe=a(vt,2);{var Pe=e=>{var s=da(),r=i(s),g=i(r);l(r);var c=a(r,2);{var T=x=>{var m=na(),C=i(m);l(m),_(I=>k(C,`Estimated final size: ~${I??""} MB`),[()=>(t(d),j(()=>t(d).final_mb.toFixed(2)))]),h(x,m)};M(c,x=>{t(d)&&x(T)})}var U=a(c,2);{var q=x=>{var m=pa(),C=i(m,!0);l(m),_(()=>k(C,t(Z))),h(x,m)};M(U,x=>{t(Z)&&x(q)})}l(s),_((x,m,C)=>k(g,`Original: ${x??""} kbps
        Target: ${m??""} kbps -> Video ~${C??""} kbps`),[()=>(t(n),j(()=>Math.round((t(n).original_video_bitrate_kbps||0)+(t(n).original_audio_bitrate_kbps||0)))),()=>(t(d),t(n),j(()=>t(d)?Math.round(t(d).total_kbps):Math.round(t(n).estimate_total_kbps))),()=>(t(d),t(n),j(()=>t(d)?Math.round(t(d).video_kbps):Math.round(t(n).estimate_video_kbps)))]),h(e,s)};M(fe,e=>{t(n)&&e(Pe)})}var ge=a(fe,2);{var Ue=e=>{var s=va(),r=i(s),g=i(r,!0);l(r),l(s),_(()=>k(g,t(D))),h(e,s)};M(ge,e=>{t(D)&&e(Ue)})}var Vt=a(ge,2),R=i(Vt),Oe=i(R,!0);l(R);var Nt=a(R,2),xe=a(Nt,2);l(Vt);var He=a(Vt,2);{var Ee=e=>{var s=ua(),r=i(s),g=i(r);l(r);var c=a(r,2),T=a(i(c),2),U=i(T,!0);l(T),l(c);var q=a(c,2);{var x=m=>{var C=ca(),I=i(C),Ve=i(I);l(I);var Ne=a(I,2);l(C),_(Re=>{k(Ve,`Completed. Final size: ${t(Q),j(()=>t(Q).final_size_mb)??""} MB`),we(Ne,"href",Re)},[()=>(Ye(ke),t(F),j(()=>ke(t(F))))]),h(m,C)};M(q,m=>{t(Q)&&m(x)})}l(s),_(m=>{ta(g,`width:${t(Y)}%`),k(U,m)},[()=>(t(L),j(()=>t(L).join(`
`)))]),h(e,s)};M(He,e=>{t(F)&&e(Ee)})}l(rt);var Rt=a(rt,2),Ke=a(Rt,2);{var Qe=e=>{var s=_a(),r=i(s),g=a(i(r),2);l(r),J(2),l(s),f("click",g,qt),f("keydown",s,Be),h(e,s)};M(Ke,e=>{t(V)&&e(Qe)})}_(()=>{R.disabled=!t(v)||t(P),k(Oe,t(P)?"Analyzing...":"Analyze"),Nt.disabled=!t(n),xe.disabled=!t(v)&&!t(F),we(Rt,"aria-expanded",t(V))}),f("change",Wt,async e=>{var r;const s=((r=e.target.files)==null?void 0:r[0])||null;o(v,s),o(X,s?It(s.size):null),s&&await lt()}),f("drop",tt,Ce),f("dragover",tt,$e),f("click",Gt,()=>N(4)),f("click",Xt,()=>N(5)),f("click",Yt,()=>N(8)),f("click",Zt,Se),f("click",te,()=>N(50)),f("click",Fe,()=>N(100)),W(ae,()=>t(u),e=>o(u,e)),H(_t,()=>t(S),e=>o(S,e)),H(gt,()=>t(z),e=>o(z,e)),H(yt,()=>t(E),e=>o(E,e)),H(St,()=>t(A),e=>o(A,e)),H(Tt,()=>t($),e=>o($,e)),H(Dt,()=>t(K),e=>o(K,e)),W(ce,()=>t(at),e=>o(at,e)),W(ue,()=>t(ot),e=>o(ot,e)),W(_e,()=>t(st),e=>o(st,e)),W(me,()=>t(it),e=>o(it,e)),f("click",R,lt),f("click",Nt,Te),f("click",xe,je),f("click",Rt,Me),h(b,Jt),Xe()}export{ka as component};
